# NCM ç½‘ç»œé…ç½®ç®¡ç†ç³»ç»Ÿï¼ˆåç«¯ï¼‰

åŸºäº FastAPI + SQLAlchemy 2.0ï¼ˆAsyncï¼‰æ„å»ºçš„ç½‘ç»œé…ç½®ç®¡ç†ç³»ç»Ÿåç«¯ï¼Œæä¾› RBACã€å®¡è®¡ã€ç½‘ç»œè‡ªåŠ¨åŒ–ç­‰èƒ½åŠ›ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ•¸ï¸ ç½‘ç»œè‡ªåŠ¨åŒ– (Network Automation)
*   **é…ç½®å¤‡ä»½**: æ”¯æŒå¤šå“ç‰Œè®¾å¤‡ï¼ˆCisco, Huawei, H3C ç­‰ï¼‰çš„é…ç½®è‡ªåŠ¨å¤‡ä»½ä¸ç‰ˆæœ¬å¯¹æ¯”ã€‚
*   **èµ„äº§å‘ç°**: åŸºäº SNMP/SSH çš„èµ„äº§å‘ç°ä¸ CMDB è‡ªåŠ¨å¯¹è´¦ã€‚
*   **å¼‚æ­¥ä»»åŠ¡**: åŸºäº Celery çš„å¤§è§„æ¨¡å¹¶è¡Œé…ç½®é‡‡é›†ã€ä¸‹å‘ä¸å·¡æ£€ã€‚
*   **å‘½ä»¤å®¡è®¡**: è®°å½•æ‰€æœ‰ç½‘ç»œé…ç½®å˜æ›´æ“ä½œï¼Œæ”¯æŒå·®å¼‚å¯¹æ¯”ï¼ˆDiffï¼‰ã€‚
*   **æ‹“æ‰‘å‘ç°**: è‡ªåŠ¨é‡‡é›† LLDP é‚»å±…å…³ç³»ï¼Œæ„å»ºç½‘ç»œç‰©ç†æ‹“æ‰‘ã€‚

### ğŸ›¡ï¸ åŸºç¡€æ¶æ„ (Infrastructure)
*   **RBAC æƒé™**: ç»†ç²’åº¦æ§åˆ¶ç”¨æˆ·å¯¹è®¾å¤‡ã€èœå•åŠæ“ä½œç çš„è®¿é—®ã€‚
*   **å®¡è®¡æ—¥å¿—**: å…¨é‡è®°å½• API è°ƒç”¨ä¸èƒŒæ™¯æ“ä½œè¯¦æƒ…ã€‚
*   **å®‰å…¨é˜²æŠ¤**: JWT åŒä»¤ç‰Œè½®æ¢ã€CSRF é˜²æŠ¤ã€HttpOnly Cookieã€‚
*   **å¼‚æ­¥é“¾è·¯**: å…¨é“¾è·¯é‡‡ç”¨ `async/await`ï¼Œé€‚é…é«˜å¹¶å‘ç½‘ç»œæ¢æµ‹ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

- Python >= 3.13
- PostgreSQL >= 16
- Redis >= 6

```bash
uv venv --python 3.13
uv sync
```

Windows è¯´æ˜ï¼šä¸€èˆ¬æ— éœ€æ‰‹åŠ¨ activateï¼Œç›´æ¥ä½¿ç”¨ `uv run ...` å³å¯ã€‚

### 2. åˆå§‹åŒ–ç¯å¢ƒ
```bash
cp .env.example .env
# æŒ‰éœ€ä¿®æ”¹ï¼šæ•°æ®åº“ã€Redisã€SECRET_KEYã€CORS ç­‰
```

Windows PowerShell å¯ç”¨ï¼š

```bash
Copy-Item .env.example .env
```

### 3. æ•°æ®åº“ä¸æ•°æ®
```bash
# åº”ç”¨ç°æœ‰è¿ç§»
uv run alembic upgrade head

# åˆå§‹åŒ–ç®¡ç†å‘˜è´¦å·ï¼ˆé»˜è®¤ï¼šadmin/123123ï¼Œè¯¦è§ .envï¼‰
uv run initial_data.py --init  # åˆå§‹è´¦å·: admin/123123
```

å¦‚éœ€å¼€å‘æ–°å¢è¿ç§»ï¼ˆä»…å¼€å‘è€…ä½¿ç”¨ï¼‰ï¼š

```bash
uv run alembic revision --autogenerate -m "your_message"
uv run alembic upgrade head
```

### 4. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨ API æœåŠ¡
uv run start.py

# å¯åŠ¨ Celery Worker (å¤„ç†ç½‘ç»œé‡‡é›†ä»»åŠ¡)
uv run start_worker.py
```

API æ–‡æ¡£ï¼šhttp://127.0.0.1:8000/docs

## ğŸ§© å¸¸è§é—®é¢˜

### 1) Alembic è¿ç§»æŠ¥ Multiple head revisions

å¹¶è¡Œå¼€å‘å¯¼è‡´è¿ç§»åˆ†å‰æ—¶ä¼šå‡ºç°æ­¤é”™è¯¯ã€‚

```bash
uv run alembic heads
```

- è‹¥å­˜åœ¨å¤šä¸ª headï¼šéœ€è¦åˆ›å»º merge revision åˆå¹¶ï¼›ç¡®ä¿æ‹‰å–åˆ°æœ€æ–°ä»£ç åå†æ‰§è¡Œï¼š

```bash
uv run alembic upgrade head
```

### 2) æ•°æ®åº“è¿æ¥å¤±è´¥

- ä¼˜å…ˆæ£€æŸ¥ `.env` ä¸­ POSTGRES_* é…ç½®ä¸ PostgreSQL æ˜¯å¦å¯è¿æ¥ã€‚
- è‹¥ä½ ä½¿ç”¨å®¹å™¨/è¿œç¨‹æ•°æ®åº“ï¼Œæ³¨æ„ç«¯å£ã€ç”¨æˆ·åä¸ç½‘ç»œè®¿é—®ç­–ç•¥ã€‚

## ğŸ“‚ ç›®å½•ç»“æ„ (ç®€)
*   `app/api/v1/endpoints/`: ä¸šåŠ¡æ¥å£ï¼ˆå«å¤‡ä»½ã€èµ„äº§ã€å·¡æ£€ç­‰ï¼‰ã€‚
*   `app/celery/tasks/`: ç½‘ç»œè‡ªåŠ¨åŒ–åå°ä»»åŠ¡é€»è¾‘ã€‚
*   `app/services/`: ä¸šåŠ¡ Service å±‚ï¼ˆåŸå­åŒ–ç¼–æ’ï¼‰ã€‚
*   `app/network/`: ç½‘ç»œé©±åŠ¨ä¸åè®®å°è£…ï¼ˆNetmiko/Scrapliç­‰é›†æˆï¼‰ã€‚

